FROM openjdk:17-jdk-slim

WORKDIR /app

COPY build/libs/*.jar app.jar

# 환경변수 정의
ARG MYSQL_HOST
ARG MYSQL_PORT
ARG MYSQL_DATABASE
ARG MYSQL_USER
ARG MYSQL_PASSWORD
ARG KAKAO_APP_ID
ARG KAKAO_CLIENT_ID
ARG KAKAO_REDIRECT_URL
ARG KAKAO_BASE_URL
ARG KAKAO_ADMIN_KEY
ARG GOOGLE_CLIENT_ID
ARG GOOGLE_REDIRECT_URL
ARG GOOGLE_BASE_URL
ARG GOOGLE_SECRET
ARG JWT_SECRET_KEY
ARG JWT_ACCESS_EXP
ARG JWT_REFRESH_EXP
ARG JWT_HEADER
ARG JWT_PREFIX
ARG REDIS_HOST
ARG REDIS_PORT
ARG REDIS_PASSWORD

# 빌드 시 주입된 환경변수를 컨테이너 환경변수로 설정
ENV MYSQL_HOST=${MYSQL_HOST}
ENV MYSQL_PORT=${MYSQL_PORT}
ENV MYSQL_DATABASE=${MYSQL_DATABASE}
ENV MYSQL_USER=${MYSQL_USER}
ENV MYSQL_PASSWORD=${MYSQL_PASSWORD}
ENV KAKAO_APP_ID=${KAKAO_APP_ID}
ENV KAKAO_CLIENT_ID=${KAKAO_CLIENT_ID}
ENV KAKAO_REDIRECT_URL=${KAKAO_REDIRECT_URL}
ENV KAKAO_BASE_URL=${KAKAO_BASE_URL}
ENV KAKAO_ADMIN_KEY=${KAKAO_ADMIN_KEY}
ENV GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
ENV GOOGLE_REDIRECT_URL=${GOOGLE_REDIRECT_URL}
ENV GOOGLE_BASE_URL=${GOOGLE_BASE_URL}
ENV GOOGLE_SECRET=${GOOGLE_SECRET}
ENV JWT_SECRET_KEY=${JWT_SECRET_KEY}
ENV JWT_ACCESS_EXP=${JWT_ACCESS_EXP}
ENV JWT_REFRESH_EXP=${JWT_REFRESH_EXP}
ENV JWT_HEADER=${JWT_HEADER}
ENV JWT_PREFIX=${JWT_PREFIX}
ENV REDIS_HOST=${REDIS_HOST}
ENV REDIS_PORT=${REDIS_PORT}
ENV REDIS_PASSWORD=${REDIS_PASSWORD}

ENTRYPOINT ["java", "-jar", "app.jar"]